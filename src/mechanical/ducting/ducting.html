<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="../styles.css">
  <style>
    /* Additional styles can be added here if needed */
  </style>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ductwork Take-Off & Budget Calculator (AK) — Materials + PDF OCR (Fixed)</title>
</head>
<body data-page="mechanical-ducting">
  <div class="wrap-1260">
    <h1>Ductwork Take-Off & Budget Calculator (Alaska) — Materials + PDF OCR</h1>

    <!-- Global Settings -->
    <div class="card">
      <div class="row">
        <div>
          <label>Auto-Gauge Mode</label>
          <select id="autoMode" class="compact">
            <option value="perimeter">Perimeter-based</option>
            <option value="smacna" selected>SMACNA by Pressure Class</option>
          </select>
        </div>
        <div>
          <label>Pressure Class</label>
          <select id="pressClass" class="compact">
            <option value="+2">+2 in.wg</option>
            <option value="-2">-2 in.wg</option>
            <option value="+3">+3 in.wg</option>
            <option value="+4" selected>+4 in.wg</option>
            <option value="+6">+6 in.wg</option>
          </select>
          <div class="mini">Also drives Auto Labor</div>
        </div>
        <div>
          <label>Mech. Labor Rate ($/hr)</label>
          <input type="number" id="laborRate" value="92" step="1" class="num" />
          <div class="mini">Anchorage default</div>
        </div>
        <div>
          <label>Labor Unit Default (hr/LF)</label>
          <input type="number" id="laborUnit" value="0.22" step="0.01" class="num" />
        </div>
        <div>
          <label>Waste Factor (%)</label>
          <input type="number" id="wastePct" value="10" step="1" class="num" />
        </div>
        <div>
          <label>Shipping (%)</label>
          <input type="number" id="shipPct" value="12" step="1" class="num" />
        </div>
        <div>
          <label>Handling (%)</label>
          <input type="number" id="handPct" value="5" step="1" class="num" />
        </div>
        <div>
          <label>Remote Add (%)</label>
          <input type="number" id="remotePct" value="15" step="1" class="num" />
        </div>
      </div>

      <div class="row">
        <div>
          <label><input type="checkbox" id="applyRemote" checked /> Apply Remote Add (%)</label>
        </div>
        <div>
          <label><input type="checkbox" id="demoMode" /> Demolition / Removal mode</label>
          <div class="mini">Focus on LBS and optional disposal cost</div>
        </div>
        <div id="demoInputs" class="hidden">
          <label>Disposal Rate ($/lb)</label>
          <input type="number" id="dispPerLb" value="0.15" step="0.01" class="num" />
        </div>
      </div>

      <div class="row">
        <div class="pill">Material Pricing ($/lb)</div>
        <div>
          <label>Galvanized</label>
          <input type="number" id="priceGalv" value="1.50" step="0.01" class="num" />
        </div>
        <div>
          <label>Stainless</label>
          <input type="number" id="priceSS" value="3.90" step="0.01" class="num" />
        </div>
        <div>
          <label>Aluminum</label>
          <input type="number" id="priceAl" value="2.75" step="0.01" class="num" />
        </div>
        <div>
          <label>Black steel</label>
          <input type="number" id="priceBlk" value="1.45" step="0.01" class="num" />
        </div>
      </div>

      <div class="mini">
        Area = <span class="mono">perimeter(in)/12 × LF</span> (rect) or <span class="mono">πD/12 × LF</span> (round).
        Weight = area × (base-gauge lb/sf × material factor + liner lb/sf + adders) + LF × (adders lb/LF) + joints × (flange lb/joint).
      </div>
    </div>

    <!-- Paste + PDF OCR -->
    <div class="row">
      <div class="card" style="flex:1 1 560px">
        <div class="pill">Paste Blueprint Text</div>
        <label class="mini">e.g., "78/28 SA, 24/18 RA, Ø18 SA …"</label>
        <div class="row">
          <textarea id="paste" rows="4" style="flex:1 1 420px" placeholder="Paste schedule/notes here…"></textarea>
          <div>
            <label>&nbsp;</label>
            <button class="primary" id="extract">Extract ➜ Rows</button>
          </div>
        </div>
      </div>

      <div class="card" style="flex:1 1 560px">
        <div class="pill">Upload PDF & Auto-Extract (Text + OCR)</div>
        <div class="row">
          <div>
            <label>PDF file</label>
            <input type="file" id="pdfFile" accept="application/pdf" />
          </div>
          <div>
            <label>Pages (e.g., 1-3 or 2,5)</label>
            <input type="text" id="pdfPages" class="size" placeholder="blank = all" />
          </div>
          <div>
            <label>Max pages</label>
            <input type="number" id="pdfMax" value="5" min="1" class="num" />
          </div>
          <div>
            <label>OCR DPI</label>
            <input type="number" id="pdfDpi" value="160" step="10" class="num" />
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="primary" id="runPdf">Run Extract</button>
          </div>
        </div>
        <div class="mini" id="pdfStatus">No PDF processed.</div>
        <div class="progress"><div id="pdfProg"></div></div>
      </div>
    </div>

    <!-- Round → Rect helper -->
    <div class="card">
      <div class="pill">Round → Rect (Equal Area)</div>
      <div class="row">
        <div>
          <label>Round Diameter (in)</label>
          <input type="number" id="rr_diam" value="18" step="0.1" class="num">
        </div>
        <div>
          <label>Aspect Ratio (W:H)</label>
          <input type="text" id="rr_aspect" value="2:1" class="size" />
          <div class="mini">Use 1:1 for square</div>
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="primary" id="rr_calc">Compute</button>
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="ghost" id="rr_add">+ Add to Rows</button>
        </div>
      </div>
      <div id="rr_out" class="mini mono"></div>
    </div>

    <!-- Line Items -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="pill">Line Items</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="primary" id="addRow">+ Add Row</button>
          <button class="ghost" id="exportCsv">Export CSV</button>
          <button class="ghost" id="reset">Clear All</button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="tbl" class="table-wide table-right table-tight">
          <thead>
            <tr>
              <th>Type</th>
              <th>Size (in)</th>
              <th>LF</th>
              <th>Material</th>
              <th>Gauge</th>
              <th>Auto G</th>
              <th>Unit Labor (hr/LF)</th>
              <th>Auto Labor</th>
              <th>Liner</th>
              <th>+ lb/sf</th>
              <th>+ lb/LF</th>
              <th>Flange</th>
              <th>Joint Spacing (ft)</th>
              <th class="nowrap">Perim (in)</th>
              <th class="nowrap">Area (sf)</th>
              <th class="nowrap">Weight (lb)</th>
              <th class="nowrap cost-col">Material $</th>
              <th class="nowrap cost-col">Ship/Hand $</th>
              <th class="nowrap cost-col">Labor $</th>
              <th class="nowrap demo-col hidden">Disposal $</th>
              <th class="nowrap">Total $</th>
              <th class="btn-cell"></th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
          <tfoot>
            <tr class="tight">
              <td colspan="13" class="mini">Totals</td>
              <td id="tPerim" class="mono"></td>
              <td id="tArea" class="mono"></td>
              <td id="tWeight" class="mono"></td>
              <td id="tMat" class="mono cost-col"></td>
              <td id="tShip" class="mono cost-col"></td>
              <td id="tLabor" class="mono cost-col"></td>
              <td id="tDisp" class="mono demo-col hidden"></td>
              <td id="tTotal" class="mono" style="font-weight:700;color:var(--accent)"></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="mini">
        Base gauge lb/sf (Galv.): 26ga 0.903 | 24ga 1.219 | 22ga 1.500 | 20ga 1.875 | 18ga 2.344 | 16ga 2.969.  
        Material factors: Galv=1.00, Stainless≈1.02, Aluminum≈0.35, Black steel≈1.00 (edit pricing above as needed).
      </div>
    </div>
  </div>

<!-- ✅ PDF.js UMD (3.x) so window.pdfjsLib exists -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" integrity="sha512-Ir5k6qV9f7MJ6MZbGqStsF3tqZcQWnQxQkJY+GyTpdC9jPQKj5V+No2B3X4Q4+0b5jLC5VuYQjC+9C9wP7oKMg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  } else {
    console.error("PDF.js failed to load — pdfjsLib is undefined.");
  }
</script>

<!-- ✅ Tesseract.js (OCR fallback) -->
<script src="https://unpkg.com/tesseract.js@5.0.3/dist/tesseract.min.js"></script>

<script src="ducting.js"></script>
</body>
</html>
